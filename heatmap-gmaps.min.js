function HeatmapOverlay(a,b){var c=this;c.heatmap=null;c.conf=b;c.latlngs=[];c.bounds=null;c.setMap(a);google.maps.event.addListener(a,"idle",function(){c.draw()})}HeatmapOverlay.prototype=new google.maps.OverlayView;HeatmapOverlay.prototype.onAdd=function(){var a=this.getPanes(),b=this.getMap().getDiv().clientWidth,c=this.getMap().getDiv().clientHeight,d=document.createElement("div");d.style.position="absolute";d.style.top=0;d.style.left=0;d.style.width=b+"px";d.style.height=c+"px";d.style.border=0;this.conf.element=d;a.overlayLayer.appendChild(d);this.heatmap=h337.create(this.conf)};HeatmapOverlay.prototype.onRemove=function(){};HeatmapOverlay.prototype.draw=function(){var a=this.getProjection();var b=this.map.getBounds();if(b.equals(this.bounds)){return}this.bounds=b;var c=a.fromLatLngToDivPixel(b.getNorthEast());var d=a.fromLatLngToDivPixel(b.getSouthWest());var e=c.y;var f=d.x;var g=d.y-c.y;var h=c.x-d.x;this.conf.element.style.left=f+"px";this.conf.element.style.top=e+"px";this.conf.element.style.width=h+"px";this.conf.element.style.height=g+"px";this.heatmap.store.get("heatmap").resize();if(this.latlngs.length>0){this.heatmap.clear();var i=this.latlngs.length,j=this.getProjection();var k={max:this.heatmap.store.max,data:[]};while(i--){var l=this.latlngs[i].latlng;if(!b.contains(l)){continue}var m=j.fromLatLngToDivPixel(l);var n=new google.maps.Point(m.x-f,m.y-e);var o=this.pixelTransform(n);k.data.push({x:o.x,y:o.y,count:this.latlngs[i].c})}this.heatmap.store.setDataSet(k)}};HeatmapOverlay.prototype.pixelTransform=function(a){var b=this.heatmap.get("width"),c=this.heatmap.get("height");while(a.x<0)a.x+=b;while(a.x>b)a.x-=b;while(a.y<0)a.y+=c;while(a.y>c)a.y-=c;a.x=~~(a.x+.5);a.y=~~(a.y+.5);return a};HeatmapOverlay.prototype.setDataSet=function(a){var b={max:a.max,data:[]};var c=a.data;var d=c.length;var e=this.getProjection();this.latlngs=[];while(d--){var f=new google.maps.LatLng(c[d].lat,c[d].lng);this.latlngs.push({latlng:f,c:c[d].count});var g=this.pixelTransform(e.fromLatLngToDivPixel(f));b.data.push({x:g.x,y:g.y,count:c[d].count})}this.heatmap.clear();this.heatmap.store.setDataSet(b)};HeatmapOverlay.prototype.addDataPoint=function(a,b,c){var d=this.getProjection(),e=new google.maps.LatLng(a,b),f=this.pixelTransform(d.fromLatLngToDivPixel(e));this.heatmap.store.addDataPoint(f.x,f.y,c);this.latlngs.push({latlng:e,c:c})};HeatmapOverlay.prototype.toggle=function(){this.heatmap.toggleDisplay()}