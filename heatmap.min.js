(function(a){var b=function(){function b(b){var c={radiusIn:20,radiusOut:40,element:{},canvas:{},acanvas:{},ctx:{},actx:{},visible:true,width:0,height:0,max:false,gradient:false,opacity:180,debug:false};this.store=new a(this);this.get=function(a){return c[a]},this.set=function(a,b){c[a]=b};this.configure(b);this.init()}function a(a){var b={data:[],heatmap:a};this.max=1;this.get=function(a){return b[a]},this.set=function(a,c){b[a]=c}}a.prototype={addDataPoint:function(a,b){if(a<0||b<0)return;var c=this,d=c.get("heatmap"),e=c.get("data");if(!e[a])e[a]=[];if(!e[a][b])e[a][b]=0;e[a][b]+=arguments.length<3?1:arguments[2];c.set("data",e);if(c.max<e[a][b]){c.max=e[a][b];d.get("actx").clearRect(0,0,d.get("width"),d.get("height"));for(var f in e)for(var g in e[f])d.drawAlpha(f,g,e[f][g]);return}d.drawAlpha(a,b,e[a][b])},setDataSet:function(a){var b=this,c=b.get("heatmap"),d=[],e=a.data,f=e.length;c.clear();this.max=a.max;while(f--){var g=e[f];c.drawAlpha(g.x,g.y,g.count);if(!d[g.x])d[g.x]=[];if(!d[g.x][g.y])d[g.x][g.y]=0;d[g.x][g.y]=g.count}this.set("data",d)},exportDataSet:function(){var a=this,b=a.get("data"),c=[];for(var d in b){if(d===undefined)continue;for(var e in b[d]){if(e===undefined)continue;c.push({x:parseInt(d,10),y:parseInt(e,10),count:b[d][e]})}}return{max:a.max,data:c}},generateRandomDataSet:function(a){var b=this.get("heatmap"),c=b.get("width"),d=b.get("height");var e={},f=Math.floor(Math.random()*1e3+1);e.max=f;var g=[];while(a--){g.push({x:Math.floor(Math.random()*c+1),y:Math.floor(Math.random()*d+1),count:Math.floor(Math.random()*f+1)})}e.data=g;this.setDataSet(e)}};b.prototype={configure:function(a){var b=this;if(a.radius){var c=a.radius,d=parseInt(c/2,10)}b.set("radiusIn",d||15),b.set("radiusOut",c||40),b.set("element",a.element instanceof Object?a.element:document.getElementById(a.element));b.set("visible",a.visible);b.set("max",a.max||false);b.set("gradient",a.gradient||{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"});b.set("opacity",parseInt(255/(100/a.opacity),10)||180);b.set("width",a.width||0);b.set("height",a.height||0);b.set("debug",a.debug)},resize:function(){var a=this.get("element"),b=this.get("canvas"),c=this.get("acanvas");b.width=c.width=a.style.width.replace(/px/,"")||this.getWidth(a);this.set("width",b.width);b.height=c.height=a.style.height.replace(/px/,"")||this.getHeight(a);this.set("height",b.height)},init:function(){var a=this,b=document.createElement("canvas"),c=document.createElement("canvas"),d=a.get("element");a.initColorPalette();a.set("canvas",b);a.set("acanvas",c);a.resize();b.style.position=c.style.position="absolute";b.style.top=c.style.top="0";b.style.left=c.style.left="0";b.style.zIndex=1e6;if(!a.get("visible"))b.style.display="none";a.get("element").appendChild(b);if(a.get("debug"))document.body.appendChild(c);a.set("ctx",b.getContext("2d"));a.set("actx",c.getContext("2d"))},initColorPalette:function(){var a=this,b=document.createElement("canvas");b.width="1";b.height="256";var c=b.getContext("2d"),d=c.createLinearGradient(0,0,1,256),e=a.get("gradient");for(var f in e){d.addColorStop(f,e[f])}c.fillStyle=d;c.fillRect(0,0,1,256);a.set("gradient",c.getImageData(0,0,1,256).data);delete b;delete d;delete c},getWidth:function(a){var b=a.offsetWidth;if(a.style.paddingLeft)b+=a.style.paddingLeft;if(a.style.paddingRight)b+=a.style.paddingRight;return b},getHeight:function(a){var b=a.offsetHeight;if(a.style.paddingTop)b+=a.style.paddingTop;if(a.style.paddingBottom)b+=a.style.paddingBottom;return b},colorize:function(a,b){var c=this,d=c.get("width"),e=c.get("radiusOut"),f=c.get("height"),g=c.get("actx"),h=c.get("ctx");var i=e*2;if(a+i>d)a=d-i;if(a<0)a=0;if(b<0)b=0;if(b+i>f)b=f-i;var j=g.getImageData(a,b,i,i),k=j.data,l=k.length,m=c.get("gradient"),n=c.get("opacity");for(var o=3;o<l;o+=4){var p=k[o],q=p*4;if(!q)continue;k[o-3]=m[q];k[o-2]=m[q+1];k[o-1]=m[q+2];k[o]=p<n?p:n}j.data=k;h.putImageData(j,a,b)},drawAlpha:function(a,b,c){var d=this,e=d.get("radiusIn"),f=d.get("radiusOut"),g=d.get("actx"),h=d.get("max"),i=g.createRadialGradient(a,b,e,a,b,f),j=a-f,k=b-f,l=2*f;i.addColorStop(0,"rgba(0,0,0,"+(c?c/d.store.max:"0.1")+")");i.addColorStop(1,"rgba(0,0,0,0)");g.fillStyle=i;g.fillRect(j,k,l,l);d.colorize(j,k)},toggleDisplay:function(){var a=this,b=a.get("visible"),c=a.get("canvas");if(!b)c.style.display="block";else c.style.display="none";a.set("visible",!b)},getImageData:function(){return this.get("canvas").toDataURL()},clear:function(){var a=this,b=a.get("width"),c=a.get("height");a.store.set("data",[]);a.get("ctx").clearRect(0,0,b,c);a.get("actx").clearRect(0,0,b,c)},cleanup:function(){var a=this;a.get("element").removeChild(a.get("canvas"));delete a}};return{create:function(a){return new b(a)},util:{mousePosition:function(a){var b,c;if(a.layerX){b=a.layerX;c=a.layerY}else if(a.offsetX){b=a.offsetX;c=a.offsetY}if(typeof b=="undefined")return;return[b,c]}}}}();a.h337=a.heatmapFactory=b})(window)